<div class="main-content">
  <div class="top-header">
    <div class="header-left">
      <button class="show-sidebar-btn" (click)="toggleSidebar.emit()">
        <i class="fas fa-bars"></i>
      </button>
      <div class="app-title">
        <h1>SQL Query & Visualization Interface</h1>
      </div>
      <div class="status-indicator">
        <div class="status-dot online"></div>
        <span>Online</span>
      </div>
    </div>
    <div class="header-right">
      <button class="header-btn" (click)="toggleFullscreen()">
        <i class="fas fa-expand"></i>
      </button>
      <button class="header-btn" (click)="clearChat()">
        <i class="fas fa-trash-alt"></i>
      </button>
    </div>
  </div>

  <div class="chat-messages" #chatMessages>
    <div
      class="message"
      [class.user-message]="msg.type === 'user'"
      [class.bot-message]="msg.type === 'bot'"
      *ngFor="let msg of messages()"
      @fadeInUp
    >
      <div class="message-avatar">
        <i class="fas" [ngClass]="msg.type === 'user' ? 'fa-user' : msg.chart ? 'fa-chart-bar' : 'fa-database'"></i>
      </div>
      <div class="message-content">
        <div class="message-bubble">
          <div class="welcome-content" [innerHTML]="msg.content"></div>
          <!-- Examples Container - only show in first welcome message -->
          <div class="examples-container" *ngIf="msg.type === 'bot' && !msg.chart && messages().indexOf(msg) === 0">
            <div class="examples-header">
              <span class="examples-title">Try these examples:</span>
            </div>
            <div class="examples-list">
              <div class="example-item">
                <span class="example-bullet">•</span>
                <code class="sql-example">SELECT * FROM students;</code>
              </div>
              <div class="example-item">
                <span class="example-bullet">•</span>
                <code class="sql-example">SELECT * FROM users;</code>
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="msg.chart" class="chart-container-message">
          <div class="chart-info-header">
            <div class="chart-title-info">{{ msg.chart.title }}</div>
            <div class="chart-meta">{{ msg.chart.values.length }} data points</div>
          </div>
          <div class="chart-display-small">
            <div [id]="'chart-' + messages().indexOf(msg)" class="plotly-chart"></div>
          </div>
          <div class="chart-axis-info">
            <div class="axis-label">
              <i class="fas fa-arrows-alt-h"></i>
              <span>X-Axis: {{ msg.chart.xAxis }}</span>
            </div>
            <div class="axis-label">
              <i class="fas fa-arrows-alt-v"></i>
              <span>Y-Axis: {{ msg.chart.yAxis }}</span>
            </div>
          </div>
        </div>
        <div class="message-time">{{ msg.time }}</div>
      </div>
    </div>
  </div>

  <app-chart-selection 
    *ngIf="showChartSelection()" 
    [chartSuggestions]="chartSuggestions()"
    (selectChart)="createChart($event)">
  </app-chart-selection>

  <!-- Advanced Chat Input Container -->
  <div class="advanced-chat-input">
    <div class="input-container">
      <div class="input-field-wrapper" [class.loading]="isLoading()">
        <div class="input-icon">
          <i class="fas fa-terminal"></i>
        </div>
        <input
          type="text"
          [ngModel]="inputMessage()"
          (ngModelChange)="inputMessage.set($event)"
          placeholder="Enter your SQL query here... (e.g., SELECT * FROM users WHERE age > 25)"
          (keypress)="($event.key === 'Enter' && !$event.shiftKey) ? sendMessage() : null"
          class="sql-input"
        />
        <div class="input-actions">
          <button class="action-btn voice-btn" [class.listening]="isListening()" (click)="toggleVoiceInput()" title="Voice Input">
            <i class="fas fa-microphone"></i>
          </button>
          <button class="action-btn clear-btn" (click)="clearInput()" title="Clear Input" *ngIf="inputMessage().trim()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      <button class="send-button" [disabled]="!inputMessage().trim()" (click)="sendMessage()" title="Send Query">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
    
    <div class="input-hints-container">
      <div class="hint-item">
        <i class="fas fa-lightbulb"></i>
        <span>Try: SELECT * FROM students WHERE grade > 80</span>
      </div>
      <div class="hint-item">
        <i class="fas fa-chart-bar"></i>
        <span>After query, choose your visualization type</span>
      </div>
      <div class="hint-item">
        <i class="fas fa-database"></i>
        <span>Available tables: users, students, products, orders</span>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <app-loading-overlay [isActive]="isLoading()" [message]="loadingMessage()" [progress]="loadingProgress()"></app-loading-overlay>

  <!-- Export Modal -->
  <app-export-modal 
    #exportModal
    [chartData]="currentChart()"
    (exportComplete)="onExportComplete()"
    (exportError)="onExportError($event)">
  </app-export-modal>
</div>